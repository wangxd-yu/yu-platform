(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[269],{60902:function(At,Ie,a){"use strict";a.r(Ie),a.d(Ie,{default:function(){return It}});var Bt=a(32157),ke=a(7573),Ue=a(86582),y=a(2824),d=a(67294),Ke=a(78009),ne=a(50208),re=a(24557),Re=a(49e3),J=a(57895),X=a(45254),B=a(90102),Pt=a(20228),Le=a(11382),$t=a(13062),Oe=a(71230),Vt=a(89032),Ne=a(15746),kt=a(49111),q=a(19650),H=a(11849),l=a(39428),g=a(3182),ze=a(952),_=a(5966),be=a(86615),Fe=a(31199),K=(0,X.Ui)("/dept");function Ut(u){return ae.apply(this,arguments)}function ae(){return ae=_asyncToGenerator(_regeneratorRuntime().mark(function u(n){return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",YuApi.queryList("".concat(K,"/tree"),n));case 1:case"end":return e.stop()}},u)})),ae.apply(this,arguments)}function Ge(u){return ue.apply(this,arguments)}function ue(){return ue=(0,g.Z)((0,l.Z)().mark(function u(n){return(0,l.Z)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",B.et(K,n));case 1:case"end":return e.stop()}},u)})),ue.apply(this,arguments)}function He(u){return le.apply(this,arguments)}function le(){return le=(0,g.Z)((0,l.Z)().mark(function u(n){return(0,l.Z)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",B.et("".concat(K,"/").concat(n,"/roles")));case 1:case"end":return e.stop()}},u)})),le.apply(this,arguments)}function Me(u){return ie.apply(this,arguments)}function ie(){return ie=(0,g.Z)((0,l.Z)().mark(function u(n){return(0,l.Z)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",B.IH(n.roleIds,"".concat(K,"/").concat(n.deptId,"/roles")));case 1:case"end":return e.stop()}},u)})),ie.apply(this,arguments)}function Ye(u){return se.apply(this,arguments)}function se(){return se=(0,g.Z)((0,l.Z)().mark(function u(n){return(0,l.Z)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",B.Hm(n.roleIds,"".concat(K,"/").concat(n.deptId,"/roles:batchDelete")));case 1:case"end":return e.stop()}},u)})),se.apply(this,arguments)}function We(u){return de.apply(this,arguments)}function de(){return de=(0,g.Z)((0,l.Z)().mark(function u(n){return(0,l.Z)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",B.FO(n,K));case 1:case"end":return e.stop()}},u)})),de.apply(this,arguments)}function Te(u){return oe.apply(this,arguments)}function oe(){return oe=(0,g.Z)((0,l.Z)().mark(function u(n){return(0,l.Z)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",B.Vx(K,n));case 1:case"end":return e.stop()}},u)})),oe.apply(this,arguments)}function Je(u){return ce.apply(this,arguments)}function ce(){return ce=(0,g.Z)((0,l.Z)().mark(function u(n){return(0,l.Z)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",B.IH(n,K));case 1:case"end":return e.stop()}},u)})),ce.apply(this,arguments)}function Qe(u){return pe.apply(this,arguments)}function pe(){return pe=(0,g.Z)((0,l.Z)().mark(function u(n){return(0,l.Z)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",B.Jp(n,K));case 1:case"end":return e.stop()}},u)})),pe.apply(this,arguments)}function Xe(u){return fe.apply(this,arguments)}function fe(){return fe=(0,g.Z)((0,l.Z)().mark(function u(n){var o;return(0,l.Z)().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return o=n.typeId?n.typeId:"0",r.abrupt("return",(0,ne.WY)((0,X.Ui)("/deptType/subTypes/".concat(o)),{method:"get"}).then(function(f){return f.map(function(F){return{label:F.name,value:F.id}})}));case 2:case"end":return r.stop()}},u)})),fe.apply(this,arguments)}function qe(u){return ve.apply(this,arguments)}function ve(){return ve=(0,g.Z)((0,l.Z)().mark(function u(n){return(0,l.Z)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,ne.WY)((0,X.Ui)("/deptType/deptId:".concat(n.deptId)),{method:"get"}).then(function(r){return r.map(function(f){return{label:f.name,value:f.id}})}));case 1:case"end":return e.stop()}},u)})),ve.apply(this,arguments)}function _e(u){return he.apply(this,arguments)}function he(){return he=(0,g.Z)((0,l.Z)().mark(function u(n){return(0,l.Z)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",B.Vx("".concat(K,"/").concat(n,"/enable")));case 1:case"end":return e.stop()}},u)})),he.apply(this,arguments)}function et(u){return me.apply(this,arguments)}function me(){return me=(0,g.Z)((0,l.Z)().mark(function u(n){return(0,l.Z)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",B.Vx("".concat(K,"/").concat(n,"/disable")));case 1:case"end":return e.stop()}},u)})),me.apply(this,arguments)}function tt(u){return Ze.apply(this,arguments)}function Ze(){return Ze=(0,g.Z)((0,l.Z)().mark(function u(n){return(0,l.Z)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",B.Vx("".concat(K,"/").concat(n.targetId,":moveIn"),n.sourceIds));case 1:case"end":return e.stop()}},u)})),Ze.apply(this,arguments)}var M=a(75159),t=a(85893),nt={labelCol:{span:6},wrapperCol:{span:12}},rt=function(n){var o,e=(0,d.useState)(),r=(0,y.Z)(e,2),f=r[0],F=r[1],R=(0,d.useState)(!0),x=(0,y.Z)(R,2),P=x[0],D=x[1],L=(0,d.useRef)();return(0,t.jsx)(Le.Z,{tip:"Loading...",spinning:P,children:(0,t.jsx)(ze.ZP,(0,H.Z)((0,H.Z)({formRef:L,layout:"horizontal"},nt),{},{params:{id:n.id},request:function(){var V=(0,g.Z)((0,l.Z)().mark(function $(A){var S;return(0,l.Z)().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return D(!0),h.next=3,We(A.id);case 3:return S=h.sent,F(S),D(!1),h.abrupt("return",Promise.resolve(S));case 7:case"end":return h.stop()}},$)}));return function($){return V.apply(this,arguments)}}(),onFinish:function($){var A=(0,H.Z)((0,H.Z)({},f),$);return M.He(A,function(){var S=(0,g.Z)((0,l.Z)().mark(function T(h){return(0,l.Z)().wrap(function(I){for(;;)switch(I.prev=I.next){case 0:return I.next=2,Te(h);case 2:return I.abrupt("return",n.deptUpdate());case 3:case"end":return I.stop()}},T)}));return function(T){return S.apply(this,arguments)}}())},submitter:{render:function($,A){return(0,t.jsx)(Oe.Z,{style:{textAlign:"center"},children:(0,t.jsx)(Ne.Z,{span:12,offset:6,children:(0,t.jsx)(q.Z,{children:A})})})}},children:n.dept.id!=="0"?(0,t.jsxs)(d.Fragment,{children:[(0,t.jsx)(_.Z,{rules:[{required:!0,message:"\u90E8\u95E8\u540D\u79F0\u4E3A\u5FC5\u586B\u9879"}],label:"\u90E8\u95E8\u540D\u79F0",name:"name"}),(0,t.jsx)(be.Z.Group,{name:"typeId",label:"\u90E8\u95E8\u7C7B\u578B",params:{deptId:n==null||(o=n.dept)===null||o===void 0?void 0:o.id},request:qe}),(0,t.jsx)(Fe.Z,{rules:[{required:!0,message:"\u6392\u5E8F\u4E3A\u5FC5\u586B\u9879"}],label:"\u6392\u5E8F",name:"sort",min:1,max:99})]}):(0,t.jsx)(d.Fragment,{children:(0,t.jsx)(_.Z,{rules:[{required:!0,message:"\u5355\u4F4D\u540D\u79F0\u4E3A\u5FC5\u586B\u9879"}],label:"\u5355\u4F4D\u540D\u79F0",name:"name"})})}))})},at=rt,Kt=a(71194),Ee=a(50146),Lt=a(57663),ge=a(71577),Ot=a(66456),we=a(64411),Nt=a(62350),ye=a(24565),zt=a(77576),xe=a(12028),Se=a(40759),ut=a(71550),lt={labelCol:{span:5},wrapperCol:{span:19}},it=function(n){var o,e;return console.log(n.initialValues),(0,t.jsxs)(ut.Z,(0,H.Z)((0,H.Z)({title:n.isAdd?"\u65B0\u5EFA\u90E8\u95E8":"\u66F4\u65B0\u90E8\u95E8",width:"600px",formRef:n.formRef},lt),{},{visible:n.visible,layout:"horizontal",onVisibleChange:function(f){n.onVisibleChange&&n.onVisibleChange(f)},onFinish:function(){var r=(0,g.Z)((0,l.Z)().mark(function f(F){var R,x;return(0,l.Z)().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:if(R=(0,H.Z)((0,H.Z)({},n.initialValues),F),R.id){D.next=7;break}return D.next=4,M.ii(R,Je);case 4:x=D.sent,D.next=10;break;case 7:return D.next=9,M.He(R,Te);case 9:x=D.sent;case 10:x&&n.onFinish&&n.onFinish(F);case 11:case"end":return D.stop()}},f)}));return function(f){return r.apply(this,arguments)}}(),initialValues:n.initialValues,children:[(0,t.jsx)(_.Z,{rules:[{required:!0,message:"\u90E8\u95E8\u540D\u79F0\u4E3A\u5FC5\u586B\u9879"}],label:"\u90E8\u95E8\u540D\u79F0",name:"name"}),((o=n.initialValues)===null||o===void 0?void 0:o.pid)&&(0,t.jsx)(_.Z,{disabled:!0,label:"\u4E0A\u7EA7\u90E8\u95E8",children:n==null?void 0:n.pDept.name}),(0,t.jsx)(be.Z.Group,{rules:[{required:!0,message:"\u90E8\u95E8\u7C7B\u578B\u4E3A\u5FC5\u586B\u9879"}],name:"typeId",label:"\u90E8\u95E8\u7C7B\u578B",params:{typeId:(e=n.pDept)===null||e===void 0?void 0:e.typeId},request:Xe}),(0,t.jsx)(Fe.Z,{rules:[{required:!0,message:"\u6392\u5E8F\u4E3A\u5FC5\u586B\u9879"}],label:"\u6392\u5E8F",name:"sort",min:1,max:99})]}))},st=it,Ce=a(49101),dt=a(57254),ot=a(60171),ct=a(11700),pt=function(n){var o=(0,d.useState)(!1),e=(0,y.Z)(o,2),r=e[0],f=e[1],F=(0,d.useState)(),R=(0,y.Z)(F,2),x=R[0],P=R[1],D=(0,d.useState)([]),L=(0,y.Z)(D,2),V=L[0],$=L[1],A=(0,d.useState)(!1),S=(0,y.Z)(A,2),T=S[0],h=S[1],E=(0,d.useState)(),I=(0,y.Z)(E,2),w=I[0],b=I[1],c=(0,d.useRef)(),Z=(0,d.useRef)();(0,d.useEffect)(function(){});var C=function v(s,p){return Array.isArray(s)&&(s==null||s.forEach(function(i){p===!0?(i.disabled=!0,i.children=i.children?v(i.children,!0):[]):i.key===n.dept.id?(i.disabled=!0,i.children=i.children?v(i.children,!1):[]):V.indexOf(i.key)>-1?(i.disabled=!0,i.children=i.children?v(i.children,!0):[]):(i.disabled=!1,i.children=i.children?v(i.children,!1):[])})),s},m=[{title:"\u540D\u79F0",dataIndex:"name"},{title:"\u7C7B\u578B",align:"center",dataIndex:"typeName"},{title:"\u6392\u5E8F",align:"center",dataIndex:"sort"},{title:"\u72B6\u6001",align:"center",dataIndex:"enabled",render:function(s,p){return[(0,t.jsx)(xe.Z,{checked:p.enabled,checkedChildren:"\u542F\u7528",unCheckedChildren:"\u505C\u7528",onClick:function(){var O;p.enabled?et(p.id):_e(p.id),(O=Z.current)===null||O===void 0||O.reload()}},"enabled")]}},{title:"\u521B\u5EFA\u65F6\u95F4",align:"center",dataIndex:"createTime"},{title:"\u64CD\u4F5C",key:"option",align:"center",valueType:"option",render:function(s,p){return[(0,t.jsx)("a",{onClick:function(){f(!0),P(p)},children:"\u7F16\u8F91"},"update"),(0,t.jsx)(ye.Z,{title:"\u786E\u8BA4\u5220\u9664\u8BE5\u8BB0\u5F55\u5417?",okText:"\u662F",cancelText:"\u5426",onConfirm:(0,g.Z)((0,l.Z)().mark(function i(){return(0,l.Z)().wrap(function(G){for(;;)switch(G.prev=G.next){case 0:return G.next=2,M.fn(Qe,p.id);case 2:Z.current&&(Z.current.reload(),n.deptChange());case 3:case"end":return G.stop()}},i)})),children:(0,t.jsx)("a",{href:"#",children:"\u5220\u9664"},"delete")},"deleteConfirm")]}}];return(0,t.jsxs)(d.Fragment,{children:[(0,t.jsx)(Se.ZP,{columns:m,rowSelection:{selections:[we.Z.SELECTION_ALL,we.Z.SELECTION_INVERT],defaultSelectedRowKeys:[]},tableAlertRender:function(s){var p=s.selectedRowKeys,i=s.onCleanSelected;return(0,t.jsx)(q.Z,{size:24,children:(0,t.jsxs)("span",{children:["\u5DF2\u9009 ",p.length," \u9879",(0,t.jsx)("a",{style:{marginLeft:8},onClick:i,children:"\u53D6\u6D88\u9009\u62E9"})]})})},tableAlertOptionRender:function(s){var p=s.selectedRowKeys;return $(p),(0,t.jsx)(q.Z,{size:16,children:(0,t.jsx)("a",{onClick:function(){h(!0)},children:"\u79FB\u52A8"})})},actionRef:Z,params:{pid:n.dept.id},request:function(s){return Ge(s)},postData:function(s){return s},rowKey:"id",search:!1,dateFormatter:"string",headerTitle:"\u5B50\u90E8\u95E8\u7BA1\u7406",toolBarRender:function(){return[(0,t.jsxs)(ge.Z,{type:"primary",onClick:function(){var p;c==null||(p=c.current)===null||p===void 0||p.resetFields(),P(void 0),f(!0)},children:[(0,t.jsx)(Ce.Z,{})," \u65B0\u5EFA"]},"primary")]}})," ",r&&(0,t.jsx)(st,{formRef:c,visible:r,initialValues:x||{pid:n.dept.id,pName:n.dept.name,enabled:!0},isAdd:!(x!=null&&x.id),pDept:n.dept,onVisibleChange:function(s){if(s){var p;c==null||(p=c.current)===null||p===void 0||p.resetFields()}else f(!1),P(void 0)},onFinish:(0,g.Z)((0,l.Z)().mark(function v(){var s;return(0,l.Z)().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:f(!1),c==null||(s=c.current)===null||s===void 0||s.resetFields(),Z.current&&(Z.current.reload(),n.deptChange());case 3:case"end":return i.stop()}},v)}))}),T&&(0,t.jsxs)(Ee.Z,{title:"\u90E8\u95E8\u79FB\u52A8",open:T,onOk:(0,g.Z)((0,l.Z)().mark(function v(){var s,p,i,O;return(0,l.Z)().wrap(function(Q){for(;;)switch(Q.prev=Q.next){case 0:return Q.next=2,M.pr({targetId:w,sourceIds:V},tt);case 2:s=Q.sent,s&&((p=Z.current)===null||p===void 0||p.reload(),(i=Z.current)!==null&&i!==void 0&&i.clearSelected&&((O=Z.current)===null||O===void 0||O.clearSelected(),$([])),n.deptChange(),h(!1));case 4:case"end":return Q.stop()}},v)})),onCancel:function(){h(!1)},okButtonProps:{disabled:!w},children:[(0,t.jsx)(ct.Z,{level:5,children:"\u76EE\u6807\u90E8\u95E8"}),(0,t.jsx)(ot.Z,{showIcon:!0,switcherIcon:(0,t.jsx)(dt.Z,{}),treeData:C(n.deptTree,!1),defaultExpandAll:!0,height:500,onSelect:function(s){s[0]&&b(s[0])}})]})]})},ft=pt,Gt=a(20136),vt=a(55241),Ht=a(94233),ee=a(51890),Ae=a(89366),ht=a(49868),te=a(72338),mt=function(n){var o=(0,d.useState)(!1),e=(0,y.Z)(o,2),r=e[0],f=e[1],F=(0,d.useState)(),R=(0,y.Z)(F,2),x=R[0],P=R[1],D=(0,d.useState)(n.deptTree),L=(0,y.Z)(D,1),V=L[0],$=(0,d.useState)(!0),A=(0,y.Z)($,2),S=A[0],T=A[1],h=(0,d.useRef)(),E=(0,d.useRef)(),I=[{dataIndex:"avatar",title:"\u5934\u50CF",align:"center",valueType:"avatar",width:150,render:function(b,c){return(0,t.jsx)(vt.Z,{content:(0,t.jsx)(q.Z,{children:c.portraitUrl?(0,t.jsx)(ee.C,{size:{xs:24,sm:32,md:40,lg:64,xl:80,xxl:100},src:"/".concat("/api","/").concat(c.portraitUrl)}):(0,t.jsx)(ee.C,{size:{xs:24,sm:32,md:40,lg:64,xl:80,xxl:100},icon:(0,t.jsx)(Ae.Z,{})})}),trigger:"hover",children:(0,t.jsx)(q.Z,{children:c.portraitUrl?(0,t.jsx)(ee.C,{src:"/".concat("/api","/").concat(c.portraitUrl)}):(0,t.jsx)(ee.C,{icon:(0,t.jsx)(Ae.Z,{})})})})}},{title:"\u7528\u6237\u8D26\u53F7",tip:"\u7528\u6237\u8D26\u53F7\u662F\u552F\u4E00\u7684 key",dataIndex:"username"},{title:"\u7528\u6237\u6635\u79F0",dataIndex:"name"},{title:"\u6240\u5C5E\u90E8\u95E8",dataIndex:"deptFullName",search:!1},{title:"\u72B6\u6001",align:"center",dataIndex:"enabled",valueType:"select",valueEnum:{true:{text:"\u542F\u7528"},false:{text:"\u505C\u7528"}},render:function(b,c){return[(0,t.jsx)(xe.Z,{checked:c.enabled,checkedChildren:"\u542F\u7528",unCheckedChildren:"\u505C\u7528",onChange:function(){var C;c.enabled?(0,te.B9)(c.id):(0,te.Dx)(c.id),(C=E.current)===null||C===void 0||C.reload()}},"enabled")]}},{title:"\u64CD\u4F5C",align:"center",dataIndex:"option",valueType:"option",render:function(b,c){return[(0,t.jsx)("a",{onClick:(0,g.Z)((0,l.Z)().mark(function Z(){return(0,l.Z)().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return m.next=2,(0,te.PR)(c.id,P);case 2:f(!0);case 3:case"end":return m.stop()}},Z)})),children:"\u7F16\u8F91"},"update"),(0,t.jsx)(ye.Z,{title:"\u786E\u8BA4\u5220\u9664\u8BE5\u8BB0\u5F55\u5417?",okText:"\u662F",cancelText:"\u5426",onConfirm:(0,g.Z)((0,l.Z)().mark(function Z(){return(0,l.Z)().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return m.next=2,M.fn(te.h8,c.id);case 2:E.current&&E.current.reload();case 3:case"end":return m.stop()}},Z)})),children:(0,t.jsx)("a",{href:"#",children:"\u5220\u9664"},"delete")},"deleteConfirm")]}}];return(0,t.jsxs)(d.Fragment,{children:[(0,t.jsx)(Se.ZP,{columns:I,actionRef:E,toolbar:{title:(0,t.jsx)(xe.Z,{checkedChildren:"\u53EA\u770B\u672C\u7EA7",unCheckedChildren:"\u672C\u7EA7\u53CA\u4E0B\u7EA7",defaultChecked:S,onChange:function(){return T(!S)}})},toolBarRender:function(){return[(0,t.jsxs)(ge.Z,{type:"primary",onClick:function(){var c;h==null||(c=h.current)===null||c===void 0||c.resetFields(),P(void 0),f(!0)},children:[(0,t.jsx)(Ce.Z,{})," \u65B0\u5EFA"]},"primary")]},params:{deptId:n.deptId,isCurrent:S},request:function(b){return B.LV((0,X.Ui)("/user"),b)},postData:function(b){return b},rowKey:"id",search:!1,dateFormatter:"string",headerTitle:"\u7528\u6237\u5217\u8868"}),r&&(0,t.jsx)(ht.Z,{deptTree:V,width:"700px",title:x!=null&&x.id?"\u66F4\u65B0\u7528\u6237":"\u65B0\u5EFA\u7528\u6237",visible:r,onVisibleChange:function(b){if(b){var c;h==null||(c=h.current)===null||c===void 0||c.resetFields()}else f(!1),P(void 0)},formRef:h,initialValues:x||{enabled:!0,deptId:n.deptId},onFinish:(0,g.Z)((0,l.Z)().mark(function w(){var b;return(0,l.Z)().wrap(function(Z){for(;;)switch(Z.prev=Z.next){case 0:f(!1),h==null||(b=h.current)===null||b===void 0||b.resetFields(),E.current&&E.current.reload();case 3:case"end":return Z.stop()}},w)}))})]})},Zt=mt,Mt=a(58996),gt=a(77933),yt=function(n){var o=(0,d.useState)(!1),e=(0,y.Z)(o,2),r=e[0],f=e[1],F=(0,d.useState)(),R=(0,y.Z)(F,2),x=R[0],P=R[1],D=(0,d.useState)([]),L=(0,y.Z)(D,2),V=L[0],$=L[1],A=(0,d.useState)(),S=(0,y.Z)(A,2),T=S[0],h=S[1],E=(0,d.useRef)(),I=(0,d.useRef)();(0,d.useEffect)(function(){B.et((0,X.Ui)("/role")).then(function(C){return $(C==null?void 0:C.data)})},[]);var w=[{title:"\u89D2\u8272\u540D\u79F0",dataIndex:"roleName"},{title:"\u89D2\u8272\u63CF\u8FF0",dataIndex:"roleRemark"},{title:"\u7ED1\u5B9A\u65F6\u95F4",align:"center",dataIndex:"bindTime"},{title:"\u64CD\u4F5C",key:"option",align:"center",valueType:"option",render:function(m,v){return[(0,t.jsx)(ye.Z,{title:"\u786E\u8BA4\u5220\u9664\u8BE5\u8BB0\u5F55\u5417?",okText:"\u662F",cancelText:"\u5426",onConfirm:(0,g.Z)((0,l.Z)().mark(function s(){return(0,l.Z)().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return console.log(v),i.next=3,M.fn(Ye,{deptId:n.deptId,roleIds:[v.roleId]});case 3:I.current&&I.current.reload();case 4:case"end":return i.stop()}},s)})),children:(0,t.jsx)("a",{href:"#",children:"\u5220\u9664"},"delete")},"deleteConfirm")]}}],b=function(){var C=(0,g.Z)((0,l.Z)().mark(function m(){var v,s;return(0,l.Z)().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,M.ii({deptId:n.deptId,roleIds:T},Me);case 2:v=i.sent,v&&(I==null||(s=I.current)===null||s===void 0||s.reload(),f(!1),h([]));case 4:case"end":return i.stop()}},m)}));return function(){return C.apply(this,arguments)}}(),c=function(){f(!1)},Z=function(m){h(m)};return(0,t.jsxs)(d.Fragment,{children:[(0,t.jsx)(Se.ZP,{columns:w,actionRef:I,params:{id:n.deptId},request:function(m){return He(m.id)},postData:function(m){return P(m),m},rowKey:"roleId",search:!1,dateFormatter:"string",headerTitle:"\u89D2\u8272\u5F15\u7528",toolBarRender:function(){return[(0,t.jsxs)(ge.Z,{type:"primary",onClick:function(){var v;E==null||(v=E.current)===null||v===void 0||v.resetFields(),f(!0),h([]),V.map(function(s){x&&(x==null?void 0:x.findIndex(function(p){return p.roleId===s.id}))>-1&&(s.disabled=!0)})},children:[(0,t.jsx)(Ce.Z,{})," \u7ED1\u5B9A"]},"primary")]}}),r&&(0,t.jsx)(Ee.Z,{title:"\u7ED1\u5B9A\u89D2\u8272",visible:r,onOk:b,onCancel:c,okButtonProps:{disabled:(T==null?void 0:T.length)==0},children:(0,t.jsx)(gt.Z,{dataSource:V,rowKey:function(m){return m.id},titles:["\u53EF\u7528","\u5DF2\u9009"],render:function(m){return m.name},targetKeys:T,onChange:Z,listStyle:{width:300,height:300}})})]})},xt=yt,St=a(6934),Ct=function u(n){var o=[];return Array.isArray(n)&&(n==null||n.forEach(function(e){var r={};e.id==="0"?r.icon=(0,t.jsx)(re.Z,{}):r.icon=(0,t.jsx)(Re.Z,{}),r.key=e.id,r.value=e.id,r.name=e.name,r.title=e.name,r.deptTypeId=e.typeId,r.children=e.children?u(e.children):[],o.push(r)})),o},jt=function u(n,o){for(var e,r=0;r<o.length;r++){var f=o[r];f.children&&(f.children.some(function(F){return F.key===n})?e=f.key:u(n,f.children)&&(e=u(n,f.children)))}return e},Dt=function(){var n=(0,ne.tT)("@@initialState"),o=n.initialState,e=o||{},r=e.currentUser,f=(0,d.useState)(r==null?void 0:r.deptId),F=(0,y.Z)(f,2),R=F[0],x=F[1],P=(0,d.useState)({id:r==null?void 0:r.deptId,name:r==null?void 0:r.deptName,typeId:r==null?void 0:r.deptTypeId}),D=(0,y.Z)(P,2),L=D[0],V=D[1],$=(0,d.useState)(),A=(0,y.Z)($,2),S=A[0],T=A[1],h=(0,d.useState)([]),E=(0,y.Z)(h,2),I=E[0],w=E[1],b=(0,d.useState)("tab1"),c=(0,y.Z)(b,2),Z=c[0],C=c[1],m=(0,d.useState)([r==null?void 0:r.deptId]),v=(0,y.Z)(m,2),s=v[0],p=v[1],i=(0,d.useState)(""),O=(0,y.Z)(i,2),G=O[0],Q=O[1],Rt=(0,d.useState)(!0),Be=(0,y.Z)(Rt,2),bt=Be[0],Pe=Be[1];(0,d.useEffect)(function(){je()},[]);var je=function(){B.et((0,X.Ui)("/dept/tree")).then(function(j){j!=null&&j.data&&(T(Ct(j==null?void 0:j.data)),Ft(j==null?void 0:j.data))})},Ft=function Y(j){for(var N=function(z){var W=j[z];w(function(De){return[].concat((0,Ue.Z)(De),[{key:W.id,title:W.name}])}),W.children&&Y(W.children)},k=0;k<j.length;k++)N(k)},Tt=function(j){p(j),Pe(!1)},Et=function(j){var N=j.target.value;if(N){var k=I==null?void 0:I.map(function(U){var z;return((z=String(U==null?void 0:U.title))===null||z===void 0?void 0:z.indexOf(N))>-1?jt(U.key,S):null}).filter(function(U,z,W){return U&&W.indexOf(U)===z});p(k.length>0?k:[r==null?void 0:r.deptId]),Q(N),Pe(!0)}else p([r==null?void 0:r.deptId])},$e=(0,d.useMemo)(function(){var Y=function j(N){return N.map(function(k){var U=k.title,z=U.indexOf(G),W=U.substring(0,z),De=U.slice(z+G.length),Ve=z>-1?(0,t.jsxs)("span",{children:[W,(0,t.jsx)("span",{style:{color:"#f50"},children:G}),De]}):(0,t.jsx)("span",{children:U}),wt=k.key==="0"?(0,t.jsx)(re.Z,{}):(0,t.jsx)(Re.Z,{});return k.children?{title:Ve,icon:wt,key:k.key,children:j(k.children)}:{title:Ve,key:k.key,icon:(0,t.jsx)(re.Z,{})}})};return S?Y(S):null},[G]);return(0,t.jsx)(Ke.ZP,{header:{breadcrumb:{}},children:(0,t.jsxs)(J.ZP,{split:"vertical",style:{height:"calc(100vh - 170px)"},children:[(0,t.jsx)(J.ZP,{colSpan:{xs:20,sm:16,md:12,lg:8,xl:6},children:S&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(St.default,{style:{marginBottom:8},placeholder:"\u90E8\u95E8\u641C\u7D22",onChange:Et}),(0,t.jsx)(ke.Z,{showIcon:!0,onExpand:Tt,blockNode:!0,expandedKeys:s,autoExpandParent:bt,style:{fontSize:"16px"},defaultSelectedKeys:[r==null?void 0:r.deptId],treeData:$e||S,selectedKeys:[R],onSelect:function(j,N){j[0]&&(x(j[0]),V({id:N.node.key,name:N.node.title,typeId:N.node.deptTypeId}))}})]})}),(0,t.jsxs)(J.ZP,{tabs:{tabPosition:"top",activeKey:Z,onChange:function(j){C(j)}},children:[(0,t.jsx)(J.ZP.TabPane,{tab:"\u57FA\u672C\u4FE1\u606F",children:Z==="tab1"&&(0,t.jsx)(at,{id:R,dept:L,deptUpdate:je})},"tab1"),(0,t.jsx)(J.ZP.TabPane,{tab:"\u5B50\u90E8\u95E8",children:Z==="tab2"&&(0,t.jsx)(ft,{dept:L,deptTree:S,deptChange:je})},"tab2"),(0,t.jsx)(J.ZP.TabPane,{tab:"\u7528\u6237\u5217\u8868",children:Z==="tab3"&&(0,t.jsx)(Zt,{deptId:R,deptTree:S})},"tab3"),(0,t.jsx)(J.ZP.TabPane,{tab:"\u89D2\u8272\u5F15\u7528",children:Z==="tab4"&&(0,t.jsx)(xt,{deptId:R})},"tab4")]})]})})},It=Dt}}]);
